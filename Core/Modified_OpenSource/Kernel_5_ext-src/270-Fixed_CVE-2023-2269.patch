--- linux_patch267/drivers/md/dm-ioctl.c	2023-08-17 11:10:42.402686735 +0800
+++ linux/drivers/md/dm-ioctl.c	2023-08-17 11:37:33.496551228 +0800
@@ -1435,11 +1435,12 @@
 		hc->new_map = NULL;
 	}
 
-	param->flags &= ~DM_INACTIVE_PRESENT_FLAG;
-
-	__dev_status(hc->md, param);
 	md = hc->md;
 	up_write(&_hash_lock);
+
+	param->flags &= ~DM_INACTIVE_PRESENT_FLAG;
+	__dev_status(md, param);
+
 	if (old_map) {
 		dm_sync_table(md);
 		dm_table_destroy(old_map);
