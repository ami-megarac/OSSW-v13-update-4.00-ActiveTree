--- linux_patch257/fs/overlayfs/copy_up.c	2023-05-04 11:48:37.949152016 +0800
+++ linux/fs/overlayfs/copy_up.c	2023-05-04 14:54:01.113919271 +0800
@@ -806,6 +806,10 @@
 	if (err)
 		return err;
 
+	if (!kuid_has_mapping(current_user_ns(), ctx.stat.uid) ||
+	    !kgid_has_mapping(current_user_ns(), ctx.stat.gid))
+		return -EOVERFLOW;
+
 	ctx.metacopy = ovl_need_meta_copy_up(dentry, ctx.stat.mode, flags);
 
 	if (parent) {
